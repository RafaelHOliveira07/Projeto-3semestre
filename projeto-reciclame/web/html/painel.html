<?php

require_once 'empresa-verifica.php';
$idEmpresa = $_SESSION['idEmpresa'];

require_once "../classes/Lixeira.php";
$lixeira = new Lixeira();
$lista = $lixeira->listarlogado($idEmpresa);

$listaJson = json_encode($lista);
require_once '../javascript/web.php'


?>


<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
 
    <!-- Carregue a API do Google Maps com um retorno de chamada -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnw1VEDXoPg6E4-Fk3SUkIPpOcIx5Y-nk&callback=initMap" async defer></script>


  <link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
/>
<link
  href="https://fonts.googleapis.com/css?family=Montserrat"
  rel="stylesheet"
/>

<link
  rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="shortcut icon" href="../img/bin-verde.png" type="image/x-icon">
  <link href="../style/stylemap.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel="stylesheet" href="../style/style-log.css">
  <link rel="stylesheet" href="../style/painel-style.css">
  <link rel="stylesheet" href="../style/style-charts.css">


  <title>Projeto-Reciclame</title>
</head>

<body>
  <main class="main-dahs">
  <header>
    <div class="h1-logo">
      <img src="../img/Free_Sample_By_Wix__3_-removebg-preview.png" alt="">
    </div>

    <nav>

      <ul>
        <li>
          <a href="">Inico</a>
        </li>
        <li>
          <a href="">Meus Pontos de Coleta</a>
        </li>
        <li>
          <a href="">Novo Ponto de Coleta</a>
        </li>
     
      </ul>
   <a href="">Sair</a>
    </nav>



  </header>
  <section >
  <div class="h2"> <span></span>
        <h2 class="card-title">Meus Pontos de Coleta</h2>
      </div>


  
    
   </section>
   
    
   
     
 
   
   <section class="dash-area">
    
       <div id="wrapper">
        
         <div class="content-area">
           <div class="container-fluid">
           
             <div class="main">
              <select name="pontos de coleta" id="pontosc" aria-placeholder="" >
                <option value="0">Escolha um de seus pontos de coleta inteligente...</option>
                <option value="0">Churrasqueira 1</option>
                <option value="0">Churrasqueira 2</option>
                <option value="0">Churrasqueira 3</option>
                <option value="0">Academia</option>
                            </select>
               <div class="row mt-4">
                 <div class="col-md-5">

                   <div class="box columnbox mt-4" id="ponto-form">
                    <li>
                      <span>Tipo: Plastico</span>
                      <span>Local/Localização: Churrasqueira 2</span>
                      <span>Status:ON</span>

                    </li>
       
                      <div class="progress-container">
                        <div class="progress-wrapper">
                          <div class="progress2"></div>
                          <div class="progress"><div class="progress-fill" id="progressFill"></div></div>
                          <div id="percentage">0%</div> <!-- Número de porcentagem no meio do gráfico -->
                      </div>
                        </div>
                        <div id="pesoDisplay"></div> <!-- Campo para exibir o peso -->
                      </div>

<script>
  // Função para atualizar o preenchimento da barra de progresso e a porcentagem
  function updateProgress(volume, limiteMaximoVolume) {
      var progressFill = document.getElementById("progressFill");
      var altura = (volume / limiteMaximoVolume) * 100;
      progressFill.style.height = altura + "%";

      // Atualiza o número de porcentagem
      var percentage = (volume / limiteMaximoVolume) * 100;
      document.getElementById("percentage").textContent = Math.round(percentage) + "%";
      
      // Atualiza o peso exibido
      updatePeso(volume);
  }

  // Função para atualizar o peso exibido
  function updatePeso(peso) {
      var pesoDisplay = document.getElementById("pesoDisplay");
      pesoDisplay.textContent = "Peso: " + peso.toFixed(2) + " Kgs"; // Arredonda o peso para 2 casas decimais
  }

  // Simulação de dados
  var volumeAtual = 0;
  var limiteMaximoVolume = 80; // Volume máximo definido

  // Atualização dos dados a cada intervalo de tempo (em milissegundos)
  var intervaloDeTempo = 10000; // 1 segundo
  setInterval(function() {
      // Incrementa o volume atual (simulação)
      volumeAtual += Math.random() * 8; // Incremento aleatório
      
      // Verifica se o volume atual ultrapassou o limite máximo
      if (volumeAtual > limiteMaximoVolume) {
          volumeAtual = limiteMaximoVolume; // Limita o volume atual ao máximo
      }

      // Atualiza a barra de progresso com os novos dados
      updateProgress(volumeAtual, limiteMaximoVolume);
  }, intervaloDeTempo);
</script>
<script>
  
    // Função para atualizar o preenchimento da barra de progresso e a porcentagem
    function updateProgress(volume, limiteMaximoVolume) {
        var progressFill = document.getElementById("progressFill");
        var percentage = (volume / limiteMaximoVolume) * 100;
        progressFill.style.height = percentage + "%";
        document.getElementById("percentage").textContent = Math.round(percentage) + "%";
    }

    // Iniciar o WebSocket e receber dados
    // Este trecho de código pode ser colocado em um arquivo JavaScript separado e incluído aqui usando a tag <script>
    var socket = new WebSocket("ws://localhost:1880/reciclame.com/ws");

    socket.onmessage = function (event) {
        var dadosRecebidos = JSON.parse(event.data);
        
        // Verifica se os dados recebidos são um array
        if (Array.isArray(dadosRecebidos) && dadosRecebidos.length > 0) {
            // Extrai os dados do primeiro elemento do array
            var primeiroElemento = dadosRecebidos[0];
            var data = primeiroElemento.data;
            
            // Verifica se há dados válidos
            if (Array.isArray(data) && data.length > 0) {
                // Assumindo que o primeiro elemento do array "data" contém o volume e o limite
                var volumeAtual = data[0][0]; // Primeiro elemento do primeiro array em data
                var limiteMaximoVolume = data[0][2]; // Terceiro elemento do primeiro array em data
                updateProgress(volumeAtual, limiteMaximoVolume);
            } else {
                console.log("Dados recebidos inválidos: array de dados vazio.");
            }
        } else {
            console.log("Dados recebidos inválidos: array de dados vazio ou não encontrado.");
        }
    };
</script>

                   </div>
                 </div>
                 <div class="col-md-7">
                   <div class="box  mt-4">
                     <div id="linechart"></div>
                   </div>
                 </div>
               </div>
   
               <div class="row">
                 <div class="col-md-5">
                   <div class="box radialbox mt-4">
                     <div id="circlechart"></div>
                   </div>
                 </div>
                 <div class="col-md-7">
                   <div class="box mt-4">
                     <div class="mt-4">
                       <div id="progress1"></div>
                     </div>
                     <div class="mt-4">
                       <div id="progress2"></div>
                     </div>
                     <div class="mt-4">
                       <div id="progress3"></div>
                     </div>
                   </div>
                 </div>
               </div>
   
               <div class="row">
                 <div class="float-right edit-on-codepen">
                   <a
                     target="_blank"
                     href="https://codepen.io/apexcharts/pen/pxZKqL"
                     ><img src="assets/edit-on-codepen.png" alt="Edit on Codepen"
                   /></a>
                 </div>
               </div>
             </div>
           </div>
         </div>
       </div>
       
      </main>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.min.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
       <script src="../javascript/dash.js"></script>
      
   

  <script>
    var socket = new WebSocket("ws://localhost:1880/reciclame.com/ws");
  </script>
 

</body>

</html>